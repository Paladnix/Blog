---
title: git 进阶
date: 2018-01-06 00:28:07
tags: [Git]
---

## 仓库概念

在git中，仓库的概念十分简单，也是最核心的概念之一。
仓库用一个文件夹来存储和描述，这个文件夹就在你项目的那个目录下，是个隐藏文件`.git/`。除此以外没有其他的位置存储这个仓库想关的信息。
这种仓库的概念非常的简约，会有一个问题，就是不小心删除的话就丢失了。因此，git的一般使用要至少进行多机备份仓库，这个备份是很简单的，在git的系统中，只是一个命令。

概念的简约，是Linus设计作品的一个特点，linux的操作系统的很多概念都非常简约。例如文件系统的概念，无论是文件夹还是设备，统一使用文件的概念去设计和使用。在这里，一个版本控制的单元使用仓库的概念，且没有那么多复杂的控制文件，就在一个小小的文件夹里，拷贝走也完全可以使用。

这种分布式仓库的概念中，没有主从关系，也没有中心关系，彼此是独立的，可以做仓库同步和融合，但是都是可控制的。

### 工作区 & 暂存区 & 版本库

这三个概念是git的核心逻辑。

**工作区** ： 就是你的实际的目录和文件。
**暂存区** ： 就是中间的一个过渡区，连接了版本库和工作区。
**版本库** ： 就是实际存放各个版本和分支的地方。

其原理是这样的，暂存区维护一份目录树，没有实际的文件。这个目录树与工作区的目录树是不一样的。工作区的目录树是操作系统中文件系统的目录树。暂存区就是存了一些文件名，时间戳，文件长度等信息。

很多时候我们会有这样的经历，我想把一些密码设置的东西，或是笔记放在我当前的目录下，但是我并不想把这部分放到仓库中，因为我会把仓库共享出去的嘛。这个时候，这个文件是存在我的工作区的，但是并不在我的暂存区，由于仓库的目录树必须由暂存区的内容来写入，所以在版本库中也不会有。

当我们对一些问件做了修改之后，使用`git status -s`就可以查看我们的当前哪些文件被修改但是没有提交到暂存区。

- 使用`git add XXX` 可以将当前在工作区修改的部分提交到暂存区，这个时候暂存区的目录树会做出修改，更新相关文件的时间戳等信息。
同时，我们的文件内容会被写入到对象库中，生成一个新的对象。并且这个对象会有和ID，这个ID会被写入到暂存区的目录树中。

- 使用`git commit` 的时候，会把暂存区的目录树更新到版本库中对应的分支的目录树中。
这个时候才是真正的写到了版本库中。

- 使用`git reset HEAD` 的时候，暂存区的目录树会被版本库中的目录树覆盖，也就是还原到了上次你提交的版本。但是此时工作区的修改是不会受到影响的。

- 使用`git rm --cache <file>` 的时候，会直接把暂存区的目录中对应的文件删除，但是工作区不受影响，不加`--cache`会将工作区的一并删除。

- 使用`git checkout` 或 `git checkout -- <file>` 命令的时候，会用暂存区中的文件去替换工作区的文件。
也就是当你写一个东西，写着写着发现不好，需要去掉，但是你已经修改了很多个文件的很多个部分，手动删除不可能做到，你可以使用这个命令来把你工作区的内容回退到你之前提交到暂存区的时候的样子。
因此，选择合适的时机进行提交操作十分重要。要在自己的开发节点上及时`add`，及时`commit`。这样可以方便回退。

- 使用`git checkout HEAD` 或 `git checkout HEAD <file>`，会用版本库中的对应分支的文件来替换暂存区和工作区的文件，这个动作可以参考上面一条，都是十分危险的动作。

有了这三个东西， 会发现，你好像什么都可以得到。
你可以历史查看你每次提交的改动，每个文件的每次提交后的样子你都可以得到。你拥有了一个结构合理，体积很小，速度很快的，无所不知的版本控制系统。
优秀的设计！


